//APP.JS
//requiring app.js
var api = require('rt_api');

//Window Start
var win = Ti.UI.createWindow({
	title : 'Current Movies',
	backgroundColor : '#fff'
});
//Window End

//Window Start
var navWin = Ti.UI.iOS.createNavigationWindow({
	window : win
});
//Window End

//Search Bar Start
var searchbar = Ti.UI.createSearchBar({
	top : 0,
	hintText : 'Search',
	barColor : '#fff'
});
//Search Bar End

//Table Start
var movieTable = Titanium.UI.createTableView({
	search : searchbar,
	font : {
		fontStyle : 'Helvetica',
		fontSize : 18
	},

	opacity : .9
});
//Table End

movieTable.addEventListener('click', function(a) {
	//calling vraibles from api start

	var title, rating, min, year, plot, critic, cast, character, pic1, pic2;

	title = a.rowData.title;
	name = a.rowData.name;
	rating = a.rowData.rating;
	min = a.rowData.min;
	year = a.rowData.year;
	plot = a.rowData.plot;
	critic = a.rowData.critic;
	cast = a.rowData.cast;
	character = a.rowData.character;
	pic1 = a.rowData.picDET;
	pic2 = a.rowData.picORG;

	//calling vraibles from api end

	//Window Start
	var evtWin = Ti.UI.createWindow({
		title : name,
		backgroundColor : '#fff',
		nav : navWin
	});
	//Window End

	//comic picture start
	var evtpic = Ti.UI.createImageView({
		height : '100%',
		width : '100%',
		image : pic2,
		opacity : .2
	});
	//comic picture end

	//Labels Begin
	var thumbView = Ti.UI.createImageView({
		height : '30%',
		width : '30%',
		top : '10%',
		left : '10%',
		image : pic1
	});

	var titleView = Ti.UI.createLabel({
		top : '10%',
		left : '43%',
		text : name,
		font : {
			fontStyle : 'Helvetica',
			fontSize : 28,
			fontWeight : 'bold'
		}
	});

	var ratingView = Ti.UI.createLabel({
		top : '16%',
		left : '43%',
		text : rating,
		font : {
			fontStyle : 'Helvetica',
			fontSize : 22
		}
	});

	var minView = Ti.UI.createLabel({
		top : '22%',
		left : '43%',
		text : min,
		font : {
			fontStyle : 'Helvetica',
			fontSize : 22
		}
	});

	var yearView = Ti.UI.createLabel({
		top : '27%',
		left : '43%',
		text : year,
		font : {
			fontStyle : 'Helvetica',
			fontSize : 22
		}
	});

	// var criticView = Ti.UI.createLabel({
		// top : '38%',
		// left : '10%',
		// text : critic,
		// font : {
			// fontStyle : 'Helvetica',
			// fontSize : 22
		// }
	// });

	var plotLabel = Ti.UI.createLabel({
		top : '41%',
		left : '10%',
		text : 'PLOT: ',
		font : {
			fontStyle : 'Helvetica',
			fontSize : 22
		}
	});

	var plotView = Ti.UI.createLabel({
		top : '44%',
		left : '10%',
		right : '10%',
		text : plot,
		font : {
			fontStyle : 'Helvetica',
			fontSize : 22
		}
	});
	//Labels End

	//EventListener Main Codes
	// criticView,
	evtWin.add(evtpic, thumbView, titleView, ratingView, minView, yearView, plotLabel, plotView);
	navWin.openWindow(evtWin, {
		animate : true
	});
});

//Main Code
win.add(movieTable);
navWin.open(); 





//MARVEL_API.JS
// //requiring app.js
// var apps = require('app');

//variables to access rotten tomattos website api

var marvelURL = 'http://api.rottentomatoes.com/api/public/v1.0/lists/movies/in_theaters.json?apikey=amkhz6m9hvbqycmrahg2xse3';

//onload function start
var apiResponse = function() {
	//converting marvel api json data
	var json = JSON.parse(this.responseText);
	var mov = json.movies;
	var array = [];

	//setting marvel api json data to variables
	for (var i = 0; i < mov.length; i++) {
		title = mov[i].title;
		rating = mov[i].mpaa_rating;
		min = mov[i].runtime + ' minutes';
		year = mov[i].year;
		plot = mov[i].synopsis;
		critic = mov[i].critics_consensus;
		picDET = mov[i].posters.detailed;
		picORG = mov[i].posters.original;

		Ti.API.info("title: " + title);
		Ti.API.info("rating: " + rating);
		Ti.API.info(min);
		Ti.API.info("year: " + year);
		Ti.API.info("plot: " + plot);
		Ti.API.info("critic: " + critic);
		Ti.API.info("poster1: " + picDET);
		Ti.API.info("poster2: " + picORG);

		// digging down into jsonData.cast array
		for (var b = 0; b < mov[i].abridged_cast.length; b++) {
			cast = mov[i].abridged_cast[b].characters;
			character = mov[i].abridged_cast[b].name;

			Ti.API.info("cast: " + cast);
			Ti.API.info("toons: " + character);
		};

		//creating row for movieTable
		var rows = Ti.UI.createTableViewRow({
			height : '10%',
			leftImage : picDET,
			title : title + '		' + rating,
			name : title,
			rating : rating,
			min : min,
			year : year,
			plot : plot,
			critic : critic,
			picDET : picDET,
			picORG : picORG,
			cast : cast,
			character : character,
			font : {
				fontStyle : 'Helvetica',
				fontSize : 24
			}
		});
		//pushing api data to array and rows
		array.push(rows);
	};
	//placing data in comicTable at app.js
	movieTable.setData(array);
};
//onload function end

//onerror function start
var apiError = function(e) {
	Ti.API.debug("Status: " + this.status);
	Ti.API.debug("Text: " + this.responseText);
	Ti.API.debug("Error: " + e.error);
	alert("Please connect to the Internet");
};
//onerror function end

//HTTPclient start
var xhr = Ti.Network.createHTTPClient({
	onload : apiResponse,
	onerror : apiError,
	timeout : 5000
});
//HTTPclient end

//Main Code
xhr.open('GET', marvelURL);
xhr.send();