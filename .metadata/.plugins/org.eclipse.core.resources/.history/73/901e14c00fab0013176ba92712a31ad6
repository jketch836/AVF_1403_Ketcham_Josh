//APP.JS
//Window Start
var win = Ti.UI.createWindow({
	title : 'Camera',
	backgroundColor : '#fff'
});
//Window End

//Window Start
var navWin = Ti.UI.iOS.createNavigationWindow({
	window : win
});

(function() {
	// load the Cloud Module
	var Cloud = require('ti.cloud');
	// set .debug property to 'true' as we are in Development mode
	Cloud.debug = true;
	var loginUser = function() {
		Cloud.Users.login({
			login : 'com.fullsail.demoApp',
			password : '12345'
		}, function(e) {
			// use .info method to view login info in the Console, if successful
			if (e.success) {
				var user = e.users[0];
				Ti.API.info('Success!\n' + 'ACS User ID: ' + user.id + '\n' + 'ACS App sessionId: ' + Cloud.sessionId + '\n' + 'ACS App Username: ' + user.username);
			} else {
				alert((e.error && e.message) || JSON.stringify(e));
			}
		});
	};
	// loginUser ends
	loginUser();
	// now your app is ready to access ACS network and data services
})();

var takePicBtn = Ti.UI.createButton({
	systemButton : Ti.UI.iPhone.SystemButton.CAMERA
});
win.setLeftNavButton(takePicBtn);

takePicBtn.addEventListener('click', function(e) {
	Ti.Media.showCamera({
		saveToPhotoGallery : true,
		allowEditing : true,
		mediaTypes : [Ti.Media.MEDIA_TYPE_VIDEO, Ti.Media.MEDIA_TYPE_PHOTO],
		success : function(e) {
			if (e.mediaType == Ti.Media.MEDIA_TYPE_PHOTO) {
				var img = Ti.UI.createImageView({
					width : win.width,
					height : win.height,
					image : e.media
				});
				win.add(img);


				//require ti.Cloud
				var Cloud = require('ti.cloud');
				
				Cloud.Photos.create({
					photo : Titanium.Filesystem.getFile('photo.jpg')
				}, function(e) {
					if (e.success) {
						var photo = e.photos[0];
						alert('Success:\n' + 'id: ' + photo.id + '\n' + 'filename: ' + photo.filename + '\n' + 'size: ' + photo.size, 'updated_at: ' + photo.updated_at);
					} else {
						alert('Error:\n' + ((e.error && e.message) || JSON.stringify(e)));
					}
				});
				Cloud.Photos.remove({
					photo_id : savedPhotoId
				}, function(e) {
					if (e.success) {
						alert('Success');
					} else {
						alert('Error:\n' + ((e.error && e.message) || JSON.stringify(e)));
					}
				});


			} else {
				alert("thought this was a photo but, it's:" + e.mediaType);
			}
		},
		error : function(error) {
			if (error.code == Ti.Media.NO_CAMERA) {
				alert("please run this on a device");
			} else {
				alert("other error: " + error.code);
			}
		}
	});
});
//Window End
win.add(takePicBtn);
navWin.open();
