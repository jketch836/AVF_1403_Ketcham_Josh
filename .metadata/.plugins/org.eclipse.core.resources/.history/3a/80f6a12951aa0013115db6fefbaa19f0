//requiring app.js
var apps = require('app');

//variables to access rotten tomattos website api

var marvelURL = 'http://api.rottentomatoes.com/api/public/v1.0/lists/movies/in_theaters.json?apikey=amkhz6m9hvbqycmrahg2xse3';

//onload function start
var apiResponse = function() {
	//converting marvel api json data
	var json = JSON.parse(this.responseText);
	var mov = json.movies;
	var array = [];

	//setting marvel api json data to variables
	for (var i = 0; i < mov.length; i++) {
		title = mov[i].title;
		rating = mov[i].mpaa_rating;
		min = mov[i].runtime + ' minutes';
		year = mov[i].year;
		plot = mov[i].synopsis;
		critic = mov[i].critics_consensus;

		Ti.API.info("title: " + title);
		Ti.API.info("rating: " + rating);
		Ti.API.info(min);
		Ti.API.info("year: " + year);
		Ti.API.info("plot: " + plot);
		Ti.API.info("critic: " + critic);

		// digging down into jsonData.posters array
		for (var a = 0; a < mov[i].posters.length; a++) {
			pic = mov[i].posters[a].detailed;

			Ti.API.info("poster: " + pic);
		};

		// digging down into jsonData.cast array
		for (var b = 0; b < mov[i].abridged_cast.length; a++) {
			cast = mov[i].abridged_cast[b].character.name;
			// character = mov[i].abridged_cast[b].character;

			Ti.API.info("cast: " + cast);
			Ti.API.info("toons: " + character);
		};

		//creating row for comicTable
		var rows = Ti.UI.createTableViewRow({
			height : '7%',
			title : title,
			rating : rating,
			min : min,
			year : year,
			plot : plot,
			critic : critic,
			pic : pic,
			cast : cast,
			character : character,
			font : {
				fontStyle : 'Helvetica',
				fontSize : 16
			}
		});
		//pushing api data to array and rows
		array.push(rows);

	};
	//placing data in comicTable at app.js
	apps.movieTable.setData(array);
};
//onload function end

//onerror function start
var apiError = function(e) {
	Ti.API.debug("Status: " + this.status);
	Ti.API.debug("Text: " + this.responseText);
	Ti.API.debug("Error: " + e.error);
	alert("Please connect to the Internet");
};
//onerror function end

//HTTPclient start
var xhr = Ti.Network.createHTTPClient({
	onload : apiResponse,
	onerror : apiError,
	timeout : 5000
});
//HTTPclient end

//Main Code
xhr.open('GET', marvelURL);
xhr.send();
