//requiring JS files
// var box = require('storage');

//Window Start
var sWin = Ti.UI.createWindow({
	title : 'FORM',
	backgroundColor : '#fff'
});
exports.sWin = sWin;
//Window End

//Search Bar Start
var searchbar = Ti.UI.createSearchBar({
	top : 0,
	hintText : 'Search',
	barColor : '#fff'
});
//Search Bar End

//Table Start
var timesTable = Ti.UI.createTableView({
	search : searchbar,
	font : {
		fontStyle : 'Helvetica',
		fontSize : 18
	},

	opacity : .9
});
exports.timesTable = timesTable;
//Table End



//Scroll View Start
var timesScroll1 = Ti.UI.createScrollView({
	layout : 'vertical',
	height : '100%',
	width : '100%',
	top : '0%',
	showVerticalScrollIndicator : true
});
//Scroll View End

//listview template start
timesTemplate1 = 
{
	properties : 
	{
		top : '1%',
		height : '7%',
		right : '10%',
		left : '10%'
	},
	childTemplates : 
	[
		{
			type : "Ti.UI.Label",
			bindId : 'name',
			properties : 
			{
				color : "black",
				font : 
				{
					fontSize : 13,
					fontFamily : "Arial"
				},
				left : '5%',
				top : '1%'
			}
		}, 
		{
			type : "Ti.UI.Label",
			bindId : 'population',
			properties : 
			{
				color : "black",
				font : 
				{
					fontSize : 11,
					fontFamily : "Arial"
				},
				right : '10%',
				top : '1%'
			},
		},
		{
			type : "Ti.UI.Label",
			bindId : 'lat',
			properties : 
			{
				color : "black",
				font : 
				{
					fontSize : 10,
					fontFamily : "Arial"
				},
				left : '25%',
				bottom : '1%'
			}
		}, 
		{
			type : "Ti.UI.Label",
			bindId : 'lng',
			properties : 
			{
				color : "black",
				font : 
				{
					fontSize : 10,
					fontFamily : "Arial"
				},
				right : '25%',
				bottom : '1%'
			}
		}
	]
};
//listview template end

//listview start
var listview1 = Ti.UI.createListView({
	//	search: search,
	top : '0%',
	// height: '500dp',
	templates : {
		'defaultTemplate' : timesTemplate1
	},
	defaultItemTemplate : 'defaultTemplate'
});
//listview end
//timesTable evt listener start
timesTable.addEventListener('click', function(e) {
	//Window Start
	var tWin = Ti.UI.createWindow({
		title : 'FORM',
		backgroundColor : '#fff'
	});
	//Window End

	//save button start
	var saveBTN = Ti.UI.createButton({
		title : 'Save',
		top : '5%',
		right : '5%'
	});

	// saveBTN.addEventListener('click', box.save);
	//save button end

	//cancel button start
	var cancelBTN = Ti.UI.createButton({
		title : 'Cancel',
		top : '5%',
		left : '5%'
	});
	cancelBTN.addEventListener('click', function() {
		tWin.close();
	});
	//cencel button end

	//Map views start
	var Map = require('ti.map');

	var view = Map.createAnnotation({
		latitude : e.source.latitude,
		longitude : e.source.longitude
	});

	var mapview = Map.createView({
		mapType : Map.NORMAL_TYPE,
		annotations : [view],
		// region : {
		// latitude : e.source.latitude,
		// longitude : e.source.longitude,
		// latitudeDelta : 0.2,
		// longitudeDelta : 0.2
		// },
		enableZoomControls : true,
		regionFit : true
	});

	//this View holds the map
	var theMapView = Ti.UI.createView({
		top : '10%',
		height : '60%',
		width : '100%'
	});
	theMapView.add(mapview);
	//Map views end

	//calling vraibles from api start
	var name, pop, dist, county, st;

	name = e.rowData.name;
	county = e.rowData.county;
	pop = e.rowData.population;
	dist = e.rowData.distance;
	st = e.rowData.st;
	cp = e.rowData.cp;
	//calling vraibles from api end

	//Labels Begin
	var titleView = Ti.UI.createLabel({
		top : '0%',
		left : '8%',
		text : name + ', ' + st,
		font : {
			fontStyle : 'Helvetica',
			fontSize : '40%',
			fontWeight : 'bold'
		}
	});

	var countyLabel = Ti.UI.createLabel({
		top : '27%',
		left : '10%',
		text : county,
		font : {
			fontStyle : 'Helvetica',
			fontSize : '30%'
		}
	});

	Number.prototype.format = function() {
		return this.toString().split(/(?=(?:\d{3})+(?:\.|$))/g).join(",");
	};

	var popLabel = Ti.UI.createLabel({
		bottom : '27%',
		left : '12%',
		right : '15%',
		font : {
			fontStyle : 'Helvetica',
			fontSize : '25%'
		}
	});

	switch (pop) {
		case null:
			popLabel.text = 'Population: Not Avalible';
			break;
		default :
			popLabel.text = 'Population: ' + pop.format();
			break;
	}
	
	var distLabel = Ti.UI.createLabel({
		bottom : '7%',
		left : '12%',
		right : '15%',
		text : 'Dist: ' + dist + ' Miles',
		font : {
			fontStyle : 'Helvetica',
			fontSize : '25%'
		}
	});

	var cpLabel = Ti.UI.createLabel({
		bottom : '0%',
		center : '12%',
		text : cp,
		font : {
			fontStyle : 'Helvetica',
			fontSize : '20%'
		}
	});
	//Labels End

	var textView = Ti.UI.createView({
		top : '69.9%',
		height : '17%',
		width : '100%',
		borderRadius : '3%',
		backgroundColor : '#EBECE4'
	});
	textView.add(titleView, countyLabel, popLabel, distLabel);

	//EventListener Main Code
	tWin.add(cancelBTN, saveBTN);
	tWin.add(theMapView, textView, cpLabel);
	tWin.open();
});

sWin.add(timesTable);
sWin.open();
