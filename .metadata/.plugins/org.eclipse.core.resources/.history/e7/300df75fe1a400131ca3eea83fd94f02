//requiring app.js
// var apps = require('app');

//variables to access marvel website api
var publicKEY = 'b2565e819b4efac81bd9df1e0486d050';
var privateKEY = 'dc653b17a624b27dd862c2d7c2c0265723bef0a1';
var ts = 2;
var hash = Ti.Utils.md5HexDigest(ts + privateKEY + publicKEY);
var marvelURL = 'http://gateway.marvel.com/v1/public/comics?ts=' + ts + '&apikey=' + publicKEY + '&hash=' + hash;
// var marvelURL = 'http://gateway.marvel.com/v1/public/comics?ts=2&apikey=b2565e819b4efac81bd9df1e0486d050&hash=08deafbaf58bb34a798973523f032104';'

//onload function start
var apiResponse = function() {
	//converting marvel api json data
	var json = JSON.parse(this.responseText);
	var jsonData = json.data.results;
	var array = [];

	//setting marvel api json data to variables
	for (var i = 0; i < jsonData.length; i++) {
		name = jsonData[i].title;
		issue = jsonData[i].issueNumber;
		desc = jsonData[i].description;
		page = jsonData[i].pageCount;
		format = jsonData[i].format;
		thumbnail1 = jsonData[i].thumbnail.path + '/portrait_xlarge.jpg';

		// console.log(name);
		// console.log(issue);
		// console.log(page);
		// console.log(format);

		// digging down into jsonData.prices array
		for (var a = 0; a < jsonData[i].prices.length; a++) {
			cost = '$' + jsonData[i].prices[a].price;

			// console.log(cost);
		};
	
		//creating row for comic listview
		var seclist = Ti.UI.createListSection({
		});

		array.push({
			properties : {
			name : name,
			issue : issue,
			desc : desc,
			page : page,
			format : format,
			thumbnail1 : thumbnail1,
			cost : cost
			},
			name : {
				text : name
			},
			issue : {
				text : issue
			},
			desc : {
				text : desc
			},
			page : {
				text : page
			},
			format : {
				text : format
			},
			thumbnail1 : {
				text : thumbnail1
			},
			cost : {
				text : cost
			}
		});
		seclist.setItems(array);

	};
	comiclistview.sections = [seclist];
};
//onload function end

//onerror function start
var apiError = function(e) {
	Ti.API.debug("Status: " + this.status);
	Ti.API.debug("Text: " + this.responseText);
	Ti.API.debug("Error: " + e.error);
	alert("Please connect to the Internet");
};
//onerror function end

//HTTPclient start
var xhr = Ti.Network.createHTTPClient({
	onload : apiResponse,
	onerror : apiError,
	timeout : 5000
});
//HTTPclient end

//Main Code
xhr.open('GET', marvelURL);
xhr.send();